<!--
#
# Typofinder for domain typo discovery
# 
# Released as open source by NCC Group Plc - http://www.nccgroup.com/
# 
# Developed by Ollie Whitehouse, ollie dot whitehouse at nccgroup dot com
#
# http://www.github.com/nccgroup/typofinder
#
# Released under AGPL see LICENSE for more information#
#
-->

<html>
<head>
    <title>NCC Typo Detector</title>
    <link rel="stylesheet" type="text/css" href="/css/style.css" />
    <link href="/css/ui-lightness/jquery-ui-1.10.3.custom.css" rel="stylesheet" />
</head>

<body>

<script src="/js/jquery-2.0.3.js"></script>
<script src="/js/jquery-ui-1.10.3.custom.js"></script>

<center>

<img src="NCCLogo.png" alt="NCC Logo" /><br /><br />
 
<!-- our form -->
Released under AGPL by <a href="http://www.nccgroup.com/">NCC Group</a> - source available <a href="https://github.com/nccgroup/typofinder">here</a><br/>

<form id="typogulator" method="post" action="/typov2.ncc">
    Supply the domain you wish to typo check and press enter<br />
    <input name="host" type="text" size="75" /> <br />
    <input type="checkbox" name="typos" value="typos" checked />Generate typos 
    <input type="checkbox" name="tld" value="tlds" checked />Swaps TLD with global TLDs<br />
</form>

<!-- events -->
<script>

    var intPBarMax = 0;
    var intPBarCount = 0;


    // this generate the accordian tag
    function generateTag(data) {
        var bVal = false;
        var strTag = "(";

        // IPv4 Address
        if (data.IPv4Addresses.length > 0) {
            strTag = strTag + "IPv4 ";
            bVal = true;
            //for (intCount = 0; intCount < data.IPv4Addresses.length; intCount++) {
            //    console.log(data.IPv4Addresses[intCount])
            //}
        }

        // IPv6 Address
        if (data.IPv6Addresses.length > 0) {
            strTag = strTag + "IPv6 ";
            bVal = true;
            //for (intCount = 0; intCount < data.IPv6Addresses.length; intCount++) {
            //    console.log(data.IP64Addresses[intCount])
            //}
        }

        // MX Records
        if (data.aMX.length > 0) {
            strTag = strTag + "MX ";
            bVal = true;
            //for (intCount = 0; intCount < data.aMX.length; intCount++) {
            //    console.log(data.aMX[intCount])
            //}
        }

        // www IPv4 Address
        if (data.wwwv4.length > 0) {
            strTag = strTag + "WWWv4 ";
            bVal = true;
            //for (intCount = 0; intCount < data.wwwv4.length; intCount++) {
            //    console.log(data.wwwv4[intCount])
            //}
        }

        // www IPv6 Address
        if (data.wwwv6.length > 0) {
            strTag = strTag + "WWWv6 ";
            bVal = true;
            //for (intCount = 0; intCount < data.wwwv6.length; intCount++) {
            //    console.log(data.wwwv6[intCount])
            //}
        }

        // m IPv4 Address
        if (data.mv4.length > 0) {
            strTag = strTag + "Mv4 ";
            bVal = true;
            //for (intCount = 0; intCount < data.mv4.length; intCount++) {
            //    console.log(data.mv4[intCount])
            //}
        }

        // m IPv6 Address
        if (data.mv6.length > 0) {
            strTag = strTag + "Mv6 ";
            bVal = true;
            //for (intCount = 0; intCount < data.mv6.length; intCount++) {
            //    console.log(data.mv6[intCount])
            //}
        }

        // webmail IPv4 Address
        if (data.webmailv4.length > 0) {
            strTag = strTag + "WebMailv4 ";
            bVal = true;
            //for (intCount = 0; intCount < data.webmailv4.length; intCount++) {
            //    console.log(data.webmailv4[intCount])
            //}
        }

        // webmail IPv6 Address
        if (data.webmailv6.length > 0) {
            strTag = strTag + "WebMailv6 ";
            bVal = true;
            //for (intCount = 0; intCount < data.webmailv6.length; intCount++) {
            //    console.log(data.webmailv6[intCount])
            //}
        }
        strTag = strTag + ")";

        if (bVal == true) return strTag;
        else return null;
    }

    // this returns an image DOM object
    // for the flag for the geo of the 
    // IPv4 address
    function geoIPImageIPv4(sIP, domLI) {
        var URL = "/geov4.ncc";

        $.post(URL, { IP: sIP }, function (data) {
            var img = document.createElement('img');
            img.src = data;
            domLI.appendChild(img);
        })
        .fail(function (xhr, textStatus, errorThrown) {
            //console.log(xhr.statusText);
            //console.log(textStatus);
            //console.log(errorThrown);
        })
        .always(function (data) {
            //console.log(data)
        }, 'json');
    }

    // this returns an image DOM object
    // for the flag for the geo of the 
    // IPv6 address
    function geoIPImageIPv6(sIP, domLI) {
        var URL = "/geov6.ncc";

        $.post(URL, { IP: sIP }, function (data) {
            //console.log(data)
            var img = document.createElement('img');
            img.src = data;
            domLI.appendChild(img);
        })
        .fail(function (xhr, textStatus, errorThrown) {
            //console.log(xhr.statusText);
            //console.log(textStatus);
            //console.log(errorThrown);
        })
        .always(function (data) {
            //console.log(data)
        }, 'json');
    }

    // this generates the div contents
    // for a particular domain
    function fillDetails(domDiv, data) {
        var ul = null;
        var li = null;

        // IPv4 Address
        if (data.IPv4Addresses.length > 0) {
            for (intCount = 0; intCount < data.IPv4Addresses.length; intCount++) {
                ul = document.createElement('ul');
                domDiv.appendChild(ul);
                li = document.createElement('li');
                ul.appendChild(li);
                li.innerText = "IPv4: " + data.IPv4Addresses[intCount];
                geoIPImageIPv4(data.IPv4Addresses[intCount], li);
            }
        }

        // IPv6 Address
        if (data.IPv6Addresses.length > 0) {
            for (intCount = 0; intCount < data.IPv6Addresses.length; intCount++) {
                ul = document.createElement('ul');
                domDiv.appendChild(ul);
                li = document.createElement('li');
                ul.appendChild(li);
                li.innerText = "IPv6: " + data.IPv6Addresses[intCount];
                geoIPImageIPv6(data.IPv6Addresses[intCount], li);
            }
        }

        // MX Records
        if (data.aMX.length > 0) {
            for (intCount = 0; intCount < data.aMX.length; intCount++) {
                ul = document.createElement('ul');
                domDiv.appendChild(ul);
                li = document.createElement('li');
                ul.appendChild(li);
                li.innerText = "MX: " + data.aMX[intCount];

                
                
                if (data.aMXIPv4[data.aMX[intCount]] != null) {
                    //console.log("MX IPv4 " + data.aMX[intCount] + " - " + data.aMXIPv4[data.aMX[intCount]]);

                    var ulinner = document.createElement('ul');
                    li.appendChild(ulinner);

                    for (IP in data.aMXIPv4[data.aMX[intCount]]) {  
                        var liinner = document.createElement('li');
                        ulinner.appendChild(liinner);
                        liinner.innerText = "MX IPv4: " + data.aMXIPv4[data.aMX[intCount]][IP];
                        geoIPImageIPv4(data.aMXIPv4[data.aMX[intCount]][IP], liinner);
                        //console.log("IPv4: " + data.aMXIPv4[data.aMX[intCount]][IP]);                                   
                    }
                }


                if (data.aMXIPv6[data.aMX[intCount]] != null) {
                    //console.log("MX IPv6 " + data.aMX[intCount] + " - " + data.aMXIPv6[data.aMX[intCount]]);

                    var ulinner = document.createElement('ul');
                    li.appendChild(ulinner);

                    for (IP in data.aMXIPv6[data.aMX[intCount]]) {
                        var liinner = document.createElement('li');
                        ulinner.appendChild(liinner);
                        liinner.innerText = "MX IPv6: " + data.aMXIPv6[data.aMX[intCount]][IP];
                        geoIPImageIPv6(data.aMXIPv6[data.aMX[intCount]][IP], liinner);
                        //console.log("IPv6: " + data.aMXIPv4[data.aMX[intCount]][IP]);                                   
                    }
                }
        
            }
        }

        // www IPv4 Address
        if (data.wwwv4.length > 0) {
            for (intCount = 0; intCount < data.wwwv4.length; intCount++) {
                ul = document.createElement('ul');
                domDiv.appendChild(ul);
                li = document.createElement('li');
                ul.appendChild(li);
                li.innerText = "www IPv4: " + data.wwwv4[intCount];
                geoIPImageIPv4(data.wwwv4[intCount], li);

                // Safebrowsing
                //if (data.SafeBrowsing.length > 0) {
                //    var ulinner = document.createElement('ul');
                //    li.appendChild(ulinner);
                //    var liinner = document.createElement('li');
                //    ulinner.appendChild(liinner);
                //    liinner.innerText = data.SafeBrowsing;
                //}
            }
        }

        // www IPv6 Address
        if (data.wwwv6.length > 0) {
            for (intCount = 0; intCount < data.wwwv6.length; intCount++) {
                ul = document.createElement('ul');
                domDiv.appendChild(ul);
                li = document.createElement('li');
                ul.appendChild(li);
                li.innerText = "www IPv6: " + data.wwwv6[intCount];
                geoIPImageIPv6(data.wwwv6[intCount], li);

                // Safebrowsing
                //if (data.SafeBrowsing.length > 0) {
                //    var ulinner = document.createElement('ul');
                //    li.appendChild(ulinner);
                //    var liinner = document.createElement('li');
                //    ulinner.appendChild(liinner);
                //    liinner.innerText = data.SafeBrowsing;
                //}
            }
        }

        // m IPv4 Address
        if (data.mv4.length > 0) {
            for (intCount = 0; intCount < data.mv4.length; intCount++) {
                ul = document.createElement('ul');
                domDiv.appendChild(ul);
                li = document.createElement('li');
                ul.appendChild(li);
                li.innerText = "m IPv4: " + data.mv4[intCount];
                geoIPImageIPv4(data.mv4[intCount], li);
            }
        }

        // m IPv6 Address
        if (data.mv6.length > 0) {
            for (intCount = 0; intCount < data.mv6.length; intCount++) {
                ul = document.createElement('ul');
                domDiv.appendChild(ul);
                li = document.createElement('li');
                ul.appendChild(li);
                li.innerText = "m IPv6: " + data.mv6[intCount];
                geoIPImageIPv6(data.mv6[intCount], li);
            }
        }

        // webmail IPv4 Address
        if (data.webmailv4.length > 0) {
            for (intCount = 0; intCount < data.webmailv4.length; intCount++) {
                ul = document.createElement('ul');
                domDiv.appendChild(ul);
                li = document.createElement('li');
                ul.appendChild(li);
                li.innerText = "webmail IPv4: " + data.webmailv4[intCount];
                geoIPImageIPv4(data.webmailv4[intCount], li);
            }
        }

        // webmail IPv6 Address
        if (data.webmailv6.length > 0) {
            for (intCount = 0; intCount < data.webmailv6.length; intCount++) {
                ul = document.createElement('ul');
                domDiv.appendChild(ul);
                li = document.createElement('li');
                ul.appendChild(li);
                li.innerText = "webmail IPv6: " + data.webmailv6[intCount];
                geoIPImageIPv6(data.webmailv6[intCount], li);
            }
        }


    }

    // this is called for each domain
    // to parse the JSON results
    function loadDetails(strDomain) {
        var URL = "/entity.ncc";
        var strTag = " ( ";
        var intCount = 0;

        $.post(URL, { host: strDomain }, function (data) {
            //console.log(data)

            // Header
            var node = document.createElement("H3");
            node.setAttribute("id", data.strDomain);


            var strTag = generateTag(data);
            if (strTag != null) {
                // Header value
                var textnode = document.createTextNode(data.strDomain + " " + strTag);
                node.appendChild(textnode);
                document.getElementById("results").appendChild(node);

                // Div
                var mydiv = document.createElement("div");
                fillDetails(mydiv, data);
                document.getElementById("results").appendChild(mydiv);
                
            } else {
                // Don't both creating those with nothing interesting
                // var textnode = document.createTextNode(data.strDomain);
            }

            intPBarCount++
            // Style
            if (intPBarCount >= intPBarMax) {
                $("#results").accordion("refresh");
                // Hide the progress bar
                document.getElementById("progressbar").style.display = "none";
                // Shows the results
                document.getElementById("results").style.display = "block";
            }

            //console.log("[debug] pbar val " + intPBarCount);
            $("#progressbar").progressbar("option", "value", intPBarCount);

            //$("#results").accordion("refresh");
        })
        .fail(function (xhr, textStatus, errorThrown) {
            //console.log(xhr.statusText);
            //console.log(textStatus);
            //console.log(errorThrown);
        })
        .always(function (data) {
            //console.log(data)
        }, 'json');
    }

    // http://gilbert.pellegrom.me/html-forms-to-ajax-forms-the-easy-way/
    $(document).ready(function () {

        // init the accordion
        $("#results").accordion();
        $("#results").accordion("option", "heightStyle", "content");

        // init the progressbar
        $("#progressbar").progressbar({
            value: 0
        });


        $("#typogulator").submit(function () {
            // Hide the form
            document.getElementById("typogulator").style.display = "none";

            //Do the AJAX post
            $.post($("#typogulator").attr("action"), $("#typogulator").serialize(), function (data) {
                //$("#results").html(data);

                intPBarMax = data.length;
                $("#progressbar").progressbar("option", "max", data.length);
                //console.log("[debug] pbar len " + data.length);

                // add them to a list 
                for (var key in data) {

                }

                // Style
                //$("#results").accordion("refresh");

                // now loop through and process them
                for (key in data) {
                    // the success function
                    loadDetails(data[key]);
                }

            });

            //Important. Stop the normal POST
            return false;
        });
    });

</script>

This product includes GeoLite data created by MaxMind,<br />
available from <a href="http://www.maxmind.com">http://www.maxmind.com</a>.
</center>

<!-- Progressbar -->
<div id="progressbar"></div>

<div id="results" class="results">
</div>

</body>
</html>
